upstream fluxbblxc {
	server 192.168.1.110:80;
}

server {
	listen 443 ssl;
	server_name forums.bunsenlabs.org;
	ssl_certificate /etc/nginx/ssl/forums.bunsenlabs.org/ssl-unified.crt;
	ssl_certificate_key /etc/nginx/ssl/forums.bunsenlabs.org/privkey.pem;
	location / {
		proxy_pass http://fluxbblxc;
		proxy_redirect off;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-For-Proto https;
		proxy_set_header X-Forwarded-Port 443;
	}
}

server {
	listen 80;
	server_name forums.bunsenlabs.org;
	return 301 https://$server_name$request_uri;
}

server {
	listen 80;
	server_name bunsen-forums-pma.2ion.eu;
	return 301 https://bunsen-forums-pma.2ion.eu$request_uri;
}

server {
	listen 443 ssl;
	server_name bunsen-forums-pma.2ion.eu;
	ssl_certificate /etc/nginx/ssl/bunsen-forums-pma.2ion.eu/ssl-unified.crt;
	ssl_certificate_key /etc/nginx/ssl/bunsen-forums-pma.2ion.eu/privkey.pem;
	location / {
		proxy_pass http://fluxbblxc;
		proxy_redirect off;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}
}

server {
	listen 80 default_server;
	listen 443 ssl default_server;
	server_name www.bunsenlabs.org;
	root /srv/www.bunsenlabs.org;
	ssl_certificate /etc/nginx/ssl/www.bunsenlabs.org/ssl-unified.crt;
	ssl_certificate_key /etc/nginx/ssl/www.bunsenlabs.org/privkey.pem;
	try_files $uri $uri/ =404;
	charset utf-8;
}

server {
	listen 80;
	server_name kernel.bunsenlabs.org;
	return 301 https://kernel.bunsenlabs.org$request_uri;
}

server {
	listen 443 ssl;
	server_name kernel.bunsenlabs.org;
	root /srv/kernel.bunsenlabs.org;
	ssl_certificate /etc/nginx/ssl/kernel.bunsenlabs.org/ssl-unified.crt;
	ssl_certificate_key /etc/nginx/ssl/kernel.bunsenlabs.org/privkey.pem;
	charset utf-8;
	location / {
		fancyindex on;
		fancyindex_exact_size off;
		auth_basic "THEY'RE GOING FOR THE KERNEL";
		auth_basic_user_file /etc/nginx/kernel.bunsenlabs.org.htpasswd;
		try_files $uri $uri/ =404;
	}
}

map $request_uri $request_basename {
		~/(?<captured_request_basename>[^/?]*)(?:\?|$) $captured_request_basename;
}
	
server {
	listen 80;
	listen 443 ssl;
	server_name pkg.bunsenlabs.org;
	root /srv/pkg.bunsenlabs.org;
	ssl_certificate /etc/nginx/ssl/pkg.bunsenlabs.org/ssl-unified.crt;
	ssl_certificate_key /etc/nginx/ssl/pkg.bunsenlabs.org/privkey.pem;
	autoindex_exact_size off;
	autoindex_localtime on;
	include /etc/nginx/mime.types;
	location ~* /(Packages|Sources|Release|InRelease)$ {
		default_type text/plain;
	}
	location /debian {
		autoindex on;
		location /debian/db {
			return 403;
		}
	}
	location /debian-legacy {
		autoindex on;
	}

	location /debian/bunsen-hydrogen {
		return 301 http://pkg.bunsenlabs.org/debian-legacy/bunsen-hydrogen/$request_basename;
	}

	location /torrents {
		autoindex on;
	}
}

server {
	listen 80;
	server_name pkg.2ion.eu;
	return 301 http://pkg.bunsenlabs.org$request_uri;
}

server {
	listen 80;
	server_name ddl.bunsenlabs.org;
	root /srv/ddl.bunsenlabs.org;
	autoindex on;
	autoindex_exact_size off;
}

server {
	listen 80;
	server_name tracker.bunsenlabs.org;
	return 301 http://www.bunsenlabs.org/installation.html;
}

server {
	listen 80;
	server_name bunsenlabs.org;
	root /srv/bunsenlabs.org;
	return 301 http://www.bunsenlabs.org$request_uri;
}

server {
	listen 443 ssl;
	server_name bunsenlabs.org;
	ssl_certificate /etc/nginx/ssl/www.bunsenlabs.org/ssl-unified.crt;
	ssl_certificate_key /etc/nginx/ssl/www.bunsenlabs.org/privkey.pem;
	root /srv/bunsenlabs.org;
	return 301 https://www.bunsenlabs.org$request_uri;
}
